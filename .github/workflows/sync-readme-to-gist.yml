# readmeをgistに自動で同期するgithub actionsの設定ファイル
name: Sync README.md to Gist

on:
  push:
    branches:
      - main  # README.mdがあるメインのブランチ名に合わせて変更してください (main, masterなど)
    paths:
      - 'README.md' # README.mdファイルへの変更があった時のみ実行

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Sync README to Gist
        env:
          GIST_PAT: ${{ secrets.GIST_PAT }}
          GIST_ID: ${{ secrets.GIST_ID }}
          FILE_PATH: 'README.md'
        run: |
          # Gist APIに送るためのJSONデータを作成
          # README.mdの内容を読み込み、JSONエスケープする
          content=$(cat $FILE_PATH | sed 's/\\/\\\\/g' | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')
          
          # Gist APIを叩いてファイルを更新
          curl -s -L -X PATCH \
            -H "Accept: application/vnd.github+json" \
            -H "Authorization: Bearer $GIST_PAT" \
            -H "X-GitHub-Api-Version: 2022-11-28" \
            "https://api.github.com/gists/$GIST_ID" \
            -d "{
              \"description\": \"Project README (auto-updated)\",
              \"files\": {
                \"README.md\": {
                  \"content\": \"$content\"
                }
              }
            }"